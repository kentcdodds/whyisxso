/** 
 * genie - v0.2.3 @license
 * (c) 2013-12-20 - Kent C. Dodds <kent@doddsfamily.us>
 * A JavaScript library committed to improving user experience by empowering users to interact with web apps using the keyboard (better than cryptic shortcuts).
 * Freely distributed under the MIT license
 * https://github.com/kentcdodds/genie
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):a.genie=b()}(this,function(){function a(){return"g-"+L++}function b(d,e,f,g,h){if(Array.isArray(d)){if("object"==typeof d[0]){for(var i=[],j=0;j<d.length;j++)i.push(b(d[j]));return i}}else{if("object"==typeof d)return b(d.magicWords,d.action,d.context,d.data,d.id);d=[d]}void 0===h&&(h=a());for(var j=0;j<d.length;j++)if("object"==typeof d[j])throw"Cannot make an object a magic word!\n"+JSON.stringify(d,null,2);e=c(e);var k={id:h,context:f||N,data:g,magicWords:d,action:e};return K[h]=k,K[h]}function c(a){return"function"==typeof a?a:("string"==typeof a&&(a={destination:a}),function(){a.openNewTab?window.open(a.destination,"_blank"):window.location.href=a.destination})}function d(a){"object"==typeof a&&a.id&&(a=a.id);var b=K[a];delete K[a];for(var c in M)-1!=M[c].indexOf(a)&&M[c].splice(M[c].indexOf(a),1);return b}function e(a){var b=[];for(var c in K)n(K[c],a)&&b.push(d(K[c]));return b}function f(){var a=w();return w({wishes:{},noWishMerge:!0,previousId:0,enteredMagicWords:[],context:N,previousContext:N,enabled:!0}),a}function g(a){var b,c,d,e,f;if(void 0===a)a="";else{if(null===a)return[];if("object"==typeof a)throw"Cannot match wishes to an object!\n"+JSON.stringify(a,null,2)}for(c=M[a]||[],b=h(c,a),c=c.concat(b),d=[],e=0;e<c.length;e++)f=K[c[e]],f&&m(f)&&d.push(f);return d}function h(a,b){var c=[],d=[];for(var e in K)if(-1==a.indexOf(e)){var f=K[e],g=i(f.magicWords,b);g!==U.noMatch&&(c[g]=c[g]||[],c[g].push(e))}for(var h=c.length;h>0;h--){var j=c[h-1];j&&(d=d.concat(j))}return d}function i(a,b){for(var c=U.noMatch,d=0;d<a.length;d++){var e=j(a[d],b);if(e>c&&(c=e),c===U.equals)break}return c}function j(a,b){var c,d,e,f,g="";if(a=(""+a).toLowerCase(),b=(""+b).toLowerCase(),b.length>a.length)return U.noMatch;if(a===b)return U.equals;if(0===a.indexOf(b))return U.startsWith;if(-1!==a.indexOf(" "+b))return U.wordStartsWith;if(-1!==a.indexOf(b))return U.contains;if(1===b.length)return U.noMatch;for(c=a.split(" "),e=0;e<c.length;e++)for(d=c[e].split("-"),f=0;f<d.length;f++)g+=d[f].substr(0,1);return-1!=g.indexOf(b)?U.acronym:k(a,b)}function k(a,b){for(var c=0,d=0;d<b.length;d++){for(var e=b[d],f=!1,g=c;g<a.length;g++){var h=a[g];if(h==e){f=!0,c=g+1;break}}if(!f)return U.noMatch}return U.matches}function l(a,b){var c,d,e,f,h;if("object"!=typeof a&&(a=K[a]),(null===a||void 0===a)&&(h=g(b),h.length>0&&(a=h[0])),!(a&&K[a.id]&&a.action&&m(a)))return null;if(a.action(a),void 0!==b){if(M[b]=M[b]||[],c=a.id,d=M[b],e=d.indexOf(c),0===e)return a;-1!=e&&d.splice(e,1),1!=e&&d.length>0&&(f=d[0],d[0]=c,c=f),d.unshift(c)}return a}function m(a){var b=O===N,c=a.context===N,d=a.context===O;return b||c||d?!0:n(a,O)}function n(a,b){b=q(b);var c=!1,d=!1;if("string"==typeof a.context)c=b.indexOf(a.context)>-1;else if(u(a.context))for(var e=0;e<b.length;e++)if(a.context.indexOf(b[e])>-1){c=!0;break}return c||d}function o(a){var b={add:[],remove:[]};return t(P,function(c){var d=!1,e=q(c.contexts),f=q(c.regexes),g=q(c.paths);t(f,function(c){c.lastIndex=0;var f=c.exec(a);if(f&&f.length>0){var g=[];_.each(e,function(a){var b=a.replace(T,function(a,b){return f[b]});g.push(b)}),b.add=b.add.concat(g),d=!0}return!d}),d||(t(g,function(c){return a===c&&(b.add=b.add.concat(e),d=!0),!d}),d||(b.remove=b.remove.concat(e)))}),b}function p(){var a=[];return t(P,function(b){var c=b.contexts;t(c,function(b){if(T.test(b)){var c=b.replace(T,".+?");t(O,function(b){new RegExp(c).test(b)&&a.push(b)})}})}),a}function q(a){return a?u(a)?a:[a]:[]}function r(a,b){b=q(b);for(var c=0;c<b.length;c++)a.indexOf(b[c])<0&&a.push(b[c])}function s(a,b){b=q(b);for(var c=0;c<a.length;)b.indexOf(a[c])>-1?a.splice(c,1):c++}function t(a,b){if(v(a)&&(a=q(a)),u(a))for(var c=0;c<a.length;c++){var d=b(a[c],c,a);if("boolean"==typeof d&&!d)break}else for(var e in a){var d=b(a[e],e,a);if("boolean"==typeof d&&!d)break}}function u(a){return a instanceof Array}function v(a){switch(typeof a){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}function w(a){return a&&(a.wishes&&(a.noWishMerge?K=a.wishes:x(a.wishes)),L=a.previousId||L,M=a.enteredMagicWords||M,O=a.context||O,Q=a.previousContext||Q,R=a.enabled||R,S=a.returnOnDisabled||S),{wishes:K,previousId:L,enteredMagicWords:M,context:O,previousContext:Q,enabled:R}}function x(a){var b;for(var c in a)b=a[c],b.action||K[c]&&(b.action=K[c].action),b.action&&(K[c]=b);return K}function y(a){return void 0!==a&&(Q=O,"string"==typeof a&&(a=[a]),O=a),O}function z(a){return Q=O,r(O,a),O}function A(a){return Q=O,s(O,a),O}function B(){return y(Q)}function C(){return y(N)}function D(a,b){if(a){var c=o(a),d=c.add,f=p();f=f.concat(c.remove),A(f),b||e(f),z(d)}return O}function E(a){return r(P,a),P}function F(a){return s(P,a),P}function G(a){return void 0!==a&&(R=a),R}function H(a){return void 0!==a&&(S=a),S}function I(a,b){return function(){return R||a===G?a.apply(this,arguments):S?b:null}}var J=null,K={},L=0,M={},N=["universe"],O=N,P=[],Q=N,R=!0,S=!0,T=/\{\{(\d+)\}\}/,U={equals:6,startsWith:5,wordStartsWith:4,contains:3,acronym:2,matches:1,noMatch:0};return J=I(b,{}),J.getMatchingWishes=I(g,[]),J.makeWish=I(l,{}),J.options=I(w,{}),J.mergeWishes=I(x,{}),J.deregisterWish=I(d,{}),J.deregisterWishesWithContext=I(e,[]),J.reset=I(f,{}),J.context=I(y,[]),J.addContext=I(z,[]),J.removeContext=I(A,[]),J.revertContext=I(B,[]),J.restoreContext=I(C,[]),J.updatePathContext=I(D,[]),J.addPathContext=I(E,[]),J.removePathContext=I(F,[]),J.enabled=I(G,!1),J.returnOnDisabled=I(H,!0),J});